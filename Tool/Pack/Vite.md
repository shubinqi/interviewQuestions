<!--
 * @Author: Shu Binqi
 * @Date: 2023-02-24 21:04:52
 * @LastEditors: Shu Binqi
 * @LastEditTime: 2023-02-28 17:07:37
 * @Description: Vite
 * @Version: 1.0.0
 * @FilePath: \interviewQuestions\Vue\Vite.md
-->

#### Vite 的实现原理？

Vite 是一种基于原生 ES 模块导入的 Web 开发构建工具，它旨在提供快速的开发体验和更快的构建速度。相比传统的构建工具（如 Webpack），Vite 采用了一些不同的实现原理，下面是 Vite 的主要实现原理：

1. **原生 ES 模块导入**：Vite 基于原生 ES 模块导入（ESM）来开发，不需要像 Webpack 一样将所有代码打包成一个或多个 JS 文件。
1. **服务器端渲染（SSR）**：Vite 使用一个基于 Koa 的本地服务器来提供文件服务，并在首次访问时对请求的文件进行动态编译和转换，将编译后的代码发送给浏览器。
1. **零配置**：Vite 不需要任何配置文件即可运行，并且使用默认的配置文件（vite.config.js）可以自定义设置。
1. **轻量级插件系统**：Vite 使用一种轻量级的插件系统，使得用户可以轻松地为项目添加功能和定制化需求。
1. **基于浏览器原生支持的功能**：Vite 使用浏览器原生支持的功能，如浏览器原生的 ES 模块和 HTTP/2，来提高加载速度和开发体验。

通过上述实现原理，Vite 在开发环境下具有快速的热更新和模块加载速度，而在生产环境下则可以利用现代浏览器的 HTTP/2 和 Service Worker 功能来提高加载速度和缓存效果。

#### Vite 和 Webpack 的区别？

Webpack 和 Vite 是两个常用的前端构建工具，它们有以下几点区别：

1. **构建速度**：Webpack 在打包时需要对整个项目进行分析和打包，构建速度相对较慢，而 Vite 采用了 ESM 原生支持的方式进行开发，因此只需对需要修改的文件进行编译，构建速度更快。
1. **开发体验**：Webpack 需要在开发过程中进行编译打包，每次修改代码需要重新编译，而 Vite 在开发过程中不需要编译，使用浏览器原生支持的 ESM 特性进行开发，修改代码后浏览器会自动更新，因此开发体验更加优秀。
1. **集成度**：Webpack 提供了更多的插件和 Loader，可以完成更多的任务，例如图片压缩、字体处理、代码拆分等等。而 Vite 的插件相对较少，但它可以集成 Rollup 和 Webpack。
1. **生态环境**：Webpack 已经成为了主流的前端构建工具，具有更加完善的生态环境和更丰富的社区支持，而 Vite 还处于发展阶段，生态环境相对较小，但它获得了 Vue.js 官方的支持，并且在 Vue.js 3 中作为默认构建工具。

总之，Webpack 和 Vite 都是优秀的前端构建工具，选择哪一个取决于项目的需求和开发团队的个人偏好。

#### Vite 对比 Webpack，优缺点在哪？

Vite 和 Webpack 都是现代前端开发中常用的构建工具，它们之间有一些区别和优缺点，如下所示：

Vite 的优点：

1. 快速的启动和热更新，开发体验更加流畅。
1. 支持原生的 ES 模块，不需要像 Webpack 那样使用额外的模块打包工具。
1. 插件系统更加简单易用，自定义性更强。
1. 内置对 Vue 3、React 等框架的支持。

Vite 的缺点：

1. 目前只支持开发阶段，生产环境需要借助其他工具进行打包。
1. 对于非 JS 文件的处理还不够完善。
1. 相对于 Webpack 社区插件资源比较少，但越来越多的插件正在陆续发布。

Webpack 的优点：

1. 对于大型项目有更好的优化效果，能够应对更多的复杂情况。
1. 生态系统丰富，插件资源丰富，能够满足更多需求。
1. 对于非 JS 文件的处理更加完善。

Webpack 的缺点：

1. 配置相对复杂，需要深入理解 Webpack 的原理和各个配置项的作用。
1. 构建速度相对较慢，对于大型项目需要较长的构建时间。
1. 开发环境下的热更新效率较低。

总的来说，Vite 更适合于小型、中型项目的快速开发，而 Webpack 更适合于大型项目和复杂项目的优化和定制。

#### 为什么说 Vite 比 Webpack 要快？

Vite 比 Webpack 快的原因主要有以下几点：

1. **按需编译**：Vite 在开发模式下使用原生 ES 模块，根据模块依赖关系，只编译修改的模块，而不是像 Webpack 一样，每次修改都会重新编译整个项目。
1. **缓存机制**：Vite 会缓存已经编译过的模块，这样下次开发时如果没有发生变化，则可以直接使用缓存，从而减少了重复的编译过程。
1. **服务器实时编译**：Vite 会启动一个服务器，通过浏览器请求模块时，实时编译和返回该模块的结果。这样就不需要像 Webpack 一样，每次修改都需要打包和写入磁盘，再重新启动服务器。
1. **优化插件**：Vite 内置了一些优化插件，例如自动按需加载组件、样式等，从而减少了不必要的网络请求。

综上所述，Vite 通过减少不必要的编译和网络请求，以及增加缓存机制和优化插件等方式来提高开发效率和速度，从而比 Webpack 更快。

#### 如何指定 Vite 插件 的执行顺序？

在 Vite 中，可以使用 plugin.after 和 plugin.before 方法指定插件的执行顺序。

例如，假设有两个插件 A 和 B，想要确保 A 插件先于 B 插件执行，可以这样配置：

```
// vite.config.js
import pluginA from './plugin-a'
import pluginB from './plugin-b'

export default {
  plugins: [
    pluginA,
    pluginB,
  ],
  // 指定插件执行顺序
  configureServer: {
    plugins: [
      pluginB.after(pluginA),
    ],
  },
}
```

在上面的例子中，使用 pluginB.after(pluginA) 方法将 B 插件设置在 A 插件之后执行。类似地，可以使用 plugin.before 方法指定插件在哪个插件之前执行。

需要注意的是，Vite 插件执行顺序的指定只适用于 server 和 build 模式，对于 dev 模式不生效。

#### Vite 插件 常见的 hook 有哪些？

Vite 插件常见的 hook 包括：

1. **configureServer**: 用于配置开发服务器，可以在此 hook 中实现自定义的中间件或修改开发服务器配置。
1. **configResolved**: 配置已经解析完成后的 hook，可以在此 hook 中根据解析完成的配置做一些修改。
1. **transform**: 用于转换导入的文件内容，可以用于处理不同类型的文件，例如处理 CSS 文件、模板文件等。
1. **resolveId**: 用于解析导入的模块路径，可以根据特定的规则修改模块路径。
1. **load**: 用于加载模块文件，可以用于在加载模块前对模块内容进行修改。
1. **transformIndexHtml**: 用于转换 index.html 文件，可以在此 hook 中对 index.html 文件进行修改。

这些 hook 可以在编写 Vite 插件时使用，以实现不同的功能。例如，通过 configureServer hook 可以自定义开发服务器的中间件，实现自定义的路由处理等功能；通过 transform hook 可以处理各种类型的文件，例如将 SCSS 文件转换为 CSS 文件、将模板文件转换为渲染函数等。

#### Vite 是否支持 commonjs 写法？

Vite 是一个现代化的打包工具，支持 ES Module（ESM）的写法，但是不支持 commonjs 的写法。这是因为 commonjs 是同步加载模块的方式，而 ESM 是异步加载模块的方式，Vite 在性能方面主要是通过 ESM 的方式来提升构建速度的，因此不支持 commonjs 的写法。如果需要在 Vite 中使用 commonjs 的模块，可以使用一些工具，如 rollup-plugin-commonjs 将 commonjs 转换成 ESM。

#### 使用 Vite 时遇到了什么问题？

Vite 在使用过程中可能会遇到一些常见问题，例如：

1. **无法识别某些模块或包**，可能是因为 Vite 不支持特定的模块系统或文件格式。此时可以尝试在配置文件中添加相应的插件或调整设置来解决问题。
1. **代码热重载无效**，可能是因为配置文件中某些选项不正确或与其他插件冲突。此时可以查看开发服务器的日志或尝试升级 Vite 版本来解决问题。
1. **构建速度慢**，可能是因为项目过于复杂或配置文件中存在低效的选项。此时可以尝试简化项目结构、调整构建选项或使用 Vite 提供的优化插件来提高构建速度。
1. **编译错误**，可能是因为代码中存在语法错误或使用了不兼容的 API。此时可以查看控制台输出的错误信息或使用 IDE 提供的代码分析工具来解决问题。

以上只是一些常见问题的示例，实际使用中还可能会遇到其他问题。解决问题的关键在于充分理解 Vite 的工作原理和配置选项，以及查阅官方文档和社区资源。
