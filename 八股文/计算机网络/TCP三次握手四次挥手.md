<!--
 * @Author: Shu Binqi
 * @Date: 2023-03-02 09:01:34
 * @LastEditors: Shu Binqi
 * @LastEditTime: 2023-03-03 01:17:44
 * @Description: 八股文：TCP 三次握手四次挥手（7题）
 * @Version: 1.0.0
 * @FilePath: \interviewQuestions\八股文\TCP三次握手四次挥手.md
-->

#### 介绍一下 TCP 三次握手四次挥手？

TCP（Transmission Control Protocol）是一种面向连接的、可靠的、基于字节流的传输层通信协议。在 TCP 通信过程中，建立连接需要进行三次握手，断开连接需要进行四次挥手。

**三次握手**

在 TCP 通信开始前，需要先进行三次握手来建立连接：

1. **第一次握手（SYN）**：客户端向服务器发送 SYN 报文，其中包含一个随机序列号 X，表示客户端准备连接服务器。
1. **第二次握手（SYN+ACK）**：服务器收到 SYN 报文之后，向客户端发送 SYN+ACK 报文，其中包含了确认号 ACK=X+1，表示服务器已经接收到客户端的请求，可以建立连接。
1. **第三次握手（ACK）**：客户端收到 SYN+ACK 报文之后，向服务器发送 ACK 报文，其中包含确认号 ACK=X+1，表示客户端已经接收到了服务器的确认，连接建立成功。

此时，TCP 连接已经建立起来了，客户端和服务器可以开始进行数据传输。

**四次挥手**

在 TCP 通信结束后，需要进行四次挥手来断开连接：

1. **第一次挥手（FIN）**：客户端向服务器发送 FIN 报文，表示客户端已经不会再发送数据了。
1. **第二次挥手（ACK）**：服务器收到 FIN 报文之后，向客户端发送 ACK 报文，表示服务器已经接收到了客户端的请求，但是还有数据需要传输。
1. **第三次挥手（FIN）**：服务器传输完数据之后，向客户端发送 FIN 报文，表示服务器已经不会再发送数据了。
1. **第四次挥手（ACK）**：客户端收到 FIN 报文之后，向服务器发送 ACK 报文，表示客户端已经接收到了服务器的请求，可以断开连接。

这样，TCP 连接就断开了。

#### 简述一下 TCP 的三次握手？为什么要三次握手，两次不行吗？

TCP 的三次握手是指建立一个 TCP 连接时，需要客户端和服务器总共发送 3 个包以确认连接的过程。具体流程如下：

1. 客户端向服务器发送 SYN 报文，表示请求建立连接，其中 SYN=1，ACK=0，seq=x。
1. 服务器收到 SYN 报文后，返回 SYN+ACK 报文，其中 SYN=1，ACK=1，seq=y，ack=x+1。
1. 客户端收到 SYN+ACK 报文后，向服务器发送 ACK 报文，其中 SYN=0，ACK=1，seq=x+1，ack=y+1。

通过三次握手的过程，可以确保客户端和服务器之间的通信是可靠的，包括：

1. 确定了双方的发送和接收能力正常，可以进行数据传输；
1. 确保客户端和服务器都能收到对方的消息，避免了因网络原因造成的消息丢失问题；
1. 防止已经失效的连接请求报文段突然又传送到了服务端，因而产生错误。

为什么要进行三次握手，而不是两次或四次呢？如果只进行两次握手，会有以下问题：

客户端发出连接请求，但在网络中滞留，由于客户端没有收到服务端的确认，就会重发请求，如果服务端收到了重复的请求，就会打开多个连接，浪费系统资源；
如果只有两次握手，当客户端发送请求后，如果服务端不响应，客户端会一直等待响应，造成资源浪费。而进行三次握手可以防止这种情况的发生。
因此，通过三次握手的方式可以更加可靠地建立连接，保证数据的安全性和稳定性。

#### 简述一下 TCP 的四次挥手？为什么需要四次挥手呢？

TCP 的四次挥手指的是在 TCP 连接关闭时，客户端和服务端之间需要发送四个数据包来完成关闭过程。其过程如下：

1. 客户端发送一个 FIN 报文，请求关闭连接。
1. 服务端收到 FIN 报文后，发送一个 ACK 报文作为响应，确认收到了客户端的请求，并进入 CLOSE_WAIT 状态。
   此时如果服务端还有数据需要发送给客户端，会继续发送数据，直到数据发送完毕，然后发送一个 FIN 报文。
1. 客户端收到 FIN 报文后，发送一个 ACK 报文作为响应，确认收到了服务端的关闭请求，进入 TIME_WAIT 状态，等待 2MSL（最长报文段寿命）后释放连接。
1. 服务端收到客户端的 ACK 报文后，进入 CLOSED 状态，连接关闭。

四次挥手是为了保证数据的可靠传输，防止因为网络延迟等原因导致的数据丢失或者重复。如果只使用三次挥手，服务端可能无法知道客户端是否已经收到了最后一个数据包。因此，四次挥手可以保证双方都能够知道对方已经完成了关闭操作。

#### HTTPS 通信（握手）过程？

HTTPS 通信是一种安全的 HTTP 通信方式，其通信过程包括 SSL 的四次握手。以下是 HTTPS 通信（握手）过程的详细步骤：

1. 客户端向服务器发送 Client Hello 报文，开始 SSL 通信。报文中包含客户端支持的 SSL 的指定版本、加密组件（Cipher Suite）列表（所使用的加密算法及密钥长度等）。
2. 服务器可进行 SSL 通信时，会以 Server Hello 报文作为应答。和客户端一样，在报文中包含 SSL 版本以及加密组件。服务器的加密组件内容是从接收到的客户端加密组件内筛选出来的。
3. 服务器发送 Certificate 报文，其中包含公开密钥证书。该证书是由服务器的证书颁发机构（CA）签发的，用于验证服务器身份和公钥的有效性。
4. 服务器发送 Server Hello Done 报文，表示握手过程结束。
5. 客户端收到服务器发来的公开密钥证书后，验证其有效性。如果证书有效，则生成一个随机数作为会话密钥，并使用服务器的公开密钥加密该密钥，然后发送给服务器。
6. 服务器收到客户端发来的加密过的会话密钥后，使用私有密钥解密该密钥，从而获得会话密钥。
7. 客户端和服务器使用会话密钥进行对称加密通信，保证通信过程的机密性和完整性。

总的来说，HTTPS 通信过程的握手包括**四次握手**，其中第一次握手是客户端向服务器发送 Client Hello 报文，第二次握手是服务器以 Server Hello 报文作为应答，第三次握手是服务器发送 Certificate 报文，第四次握手是服务器发送 Server Hello Done 报文。在握手过程中，客户端和服务器会交换信息，验证对方的身份和证书的有效性，并生成一个会话密钥，用于后续的加密通信。
