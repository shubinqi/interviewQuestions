<!--
 * @Author: Shu Binqi
 * @Date: 2023-03-05 23:58:10
 * @LastEditors: Shu Binqi
 * @LastEditTime: 2023-03-06 01:07:55
 * @Description: 八股文；浏览器缓存机制
 * @Version: 1.0.0
 * @FilePath: \interviewQuestions\八股文\浏览器\浏览器缓存机制.md
-->

#### 对浏览器缓存机制的理解？

浏览器缓存机制是指浏览器在访问同一资源时会先检查本地缓存中是否存在该资源的副本，并根据不同情况决定是否从服务器重新获取资源。浏览器缓存机制有助于提高网站的性能和减轻服务器的负担。

浏览器缓存机制一般可以分为以下几种类型：

1. **强缓存**：浏览器在第一次请求资源时，会先检查本地是否有缓存副本，如果有并且未过期，则直接使用缓存，不会向服务器发送请求，从而提高页面的访问速度。强制缓存可以通过设置 HTTP 响应头中的 Expires 或 Cache-Control 字段实现。
1. **协商缓存**：如果强制缓存失效，浏览器会发送请求到服务器，服务器在响应中返回一些缓存信息（如 Last-Modified 和 ETag），浏览器会将这些信息保存到本地缓存中。下一次请求时，浏览器会通过 If-Modified-Since 或 If-None-Match 字段将这些缓存信息发送给服务器，服务器根据这些信息判断资源是否发生变化，如果没有变化，服务器会返回一个 304 响应，告诉浏览器可以使用本地缓存，如果资源发生了变化，则会返回最新的资源。协商缓存可以通过设置 HTTP 响应头中的 Last-Modified 或 ETag 字段实现。
1. **Service Worker 缓存**：Service Worker 是一种运行在浏览器后台的脚本，可以拦截并缓存浏览器发出的请求，以便在下次访问时快速响应请求。Service Worker 缓存可以通过使用 Service Worker 技术实现，它可以对页面的请求进行拦截，然后决定是返回缓存中的响应还是发起网络请求。

除了上述缓存机制外，还有一些浏览器缓存相关的问题需要注意，如：

1. **缓存的版本号更新**：如果资源发生了改变，需要更新缓存的版本号，以便浏览器能够正确地判断资源是否过期。
1. **跨域资源的缓存**：如果资源跨域，需要在服务器端配置相应的 HTTP 响应头，才能让浏览器正确地缓存资源。
1. **缓存的清理与失效**：缓存中的资源有时需要手动清理或者自动失效，以便浏览器能够获取到最新的资源。可以通过手动清理浏览器缓存或者使用 HTTP 响应头中的 Cache-Control 字段来实现。

#### 浏览器资源缓存的位置有哪些？

浏览器资源缓存主要有以下几个位置：

1. **HTTP 缓存**：指浏览器中内置的 HTTP 缓存，主要用于缓存 HTTP 请求和响应，可以通过设置 HTTP 头来控制缓存的行为。
1. **Service Worker 缓存**：Service Worker 是一种在浏览器后台运行的脚本，可以用于实现离线缓存和资源预加载等功能，可以通过 Service Worker 缓存来管理应用程序的资源缓存。
1. **Web Storage**：Web Storage 包括 localStorage 和 sessionStorage，是一种在浏览器中存储数据的机制，可以通过设置键值对来存储和读取数据，常用于保存用户的偏好设置、登录信息等。
1. **IndexedDB**：IndexedDB 是一种在浏览器中存储大量结构化数据的机制，可以通过 JavaScript API 来读取和写入数据，常用于离线存储和缓存数据等。
1. **WebSQL**：WebSQL 是一种在浏览器中使用 SQL 语言来操作数据库的机制，但已经被废弃，不再推荐使用。

总的来说，浏览器资源缓存可以分为两种类型：HTTP 缓存和离线缓存。HTTP 缓存通常用于缓存网页和静态资源，可以提高网页加载速度和减少网络带宽的消耗；离线缓存则常用于实现离线访问和应用程序的缓存，可以使用户在离线状态下也能够访问应用程序的部分或全部功能。

#### 协商缓存和强缓存的区别？

协商缓存和强缓存是浏览器缓存机制中的两个重要概念，它们的区别如下：

1. **强缓存**：浏览器在请求资源时，如果发现该资源存在强缓存，就不会向服务器发送请求，直接从本地缓存中读取资源并返回给客户端。强缓存可以通过设置 Expires 和 Cache-Control 响应头来实现。
   a. Expires：过期时间，用于指定资源到期的时间，是服务器返回的一个绝对时间，如果客户端的时间与服务器时间不一致，就可能会造成误差。缺点是 HTTP1.0 版本的浏览器对其支持良好，而 HTTP1.1 中推荐使用 Cache-Control。
   b. Cache-Control：缓存控制，用于指定资源的缓存机制，常用的属性有：

   - max-age：缓存的最大有效时间（秒），优先级高于 Expires，一般使用此属性来设置缓存时间；
   - no-cache：强制客户端向服务器进行重新验证；
   - no-store：禁止缓存，每次都需要向服务器重新请求资源。

2. **协商缓存**：浏览器在请求资源时，如果发现该资源存在协商缓存，就会向服务器发送一个请求，由服务器根据该请求中的一些参数来决定是否返回资源的新内容。如果服务器判断该资源未发生变化，则返回一个 304 状态码，告诉浏览器可以使用本地缓存，否则返回新的资源内容。协商缓存可以通过设置 Last-Modified/Etag 和 If-Modified-Since/If-None-Match 请求头和响应头来实现。
   a. Last-Modified：资源的最后修改时间，是服务器返回的一个相对时间。浏览器在下一次请求时会通过 If-Modified-Since 请求头将上一次返回的 Last-Modified 时间发送给服务器，如果资源未发生修改，服务器会返回 304 状态码。
   b. Etag：资源的唯一标识符，是服务器返回的一个字符串。浏览器在下一次请求时会通过 If-None-Match 请求头将上一次返回的 Etag 发送给服务器，如果资源未发生修改，服务器会返回 304 状态码。

协商缓存和强缓存可以同时存在，浏览器先根据强缓存的设置判断是否直接使用本地缓存，如果过期或未命中，则向服务器发送一个请求，由服务器根据协商缓存的设置决定是否返回新内容。

#### 为什么需要浏览器缓存？

浏览器缓存是指浏览器在本地缓存 Web 资源，以便下次打开同样的页面时可以直接从本地读取资源，而无需重新从网络下载，从而提高页面加载速度和用户体验。

浏览器缓存的好处包括：

1. 减少网络传输数据量，降低服务器负担和网络带宽成本。
1. 缩短页面加载时间，提高用户体验。
1. 减少资源的重复请求，从而减少服务器压力和网络流量。

总之，浏览器缓存可以显著提升页面加载速度和用户体验，同时减轻服务器负担和网络带宽成本。
