<!--
 * @Author: Shu Binqi
 * @Date: 2023-02-27 22:46:08
 * @LastEditors: Shu Binqi
 * @LastEditTime: 2023-03-03 02:00:36
 * @Description: DNS 面试题（5题）
 * @Version: 1.0.0
 * @FilePath: \interviewQuestions\ComputerNetwork\DNS.md
-->

#### DNS 协议是什么？

DNS（Domain Name System）协议是一种将域名（例如“example.com”）转换为与之关联的 IP 地址（例如“192.0.2.1”）的系统。DNS 协议提供了一个分布式的数据库系统，它将域名映射到相应的 IP 地址，以便在互联网上正确地路由和寻址网络数据。

DNS 协议通常使用 UDP 协议进行通信，但也可以使用 TCP 协议。基本的 DNS 协议包含两种类型的信息：查询和响应。查询信息由客户端发出，请求解析特定的域名。响应信息包含该域名所对应的 IP 地址。

#### DNS 完整的查询过程？

DNS（Domain Name System）是一个用于将域名转换为 IP 地址的系统。当我们在浏览器中输入一个域名时，浏览器会首先向本地 DNS 服务器发送一个 DNS 查询请求，获取该域名对应的 IP 地址，然后才能与该域名对应的服务器建立连接。

下面是一个完整的 DNS 查询过程：

1. 浏览器向本地 DNS 服务器发送 DNS 查询请求，请求解析该域名对应的 IP 地址。
1. 如果本地 DNS 服务器中没有该域名对应的 IP 地址，则该请求会被转发到一个根域名服务器。根域名服务器会返回一个 TLD（Top Level Domain，顶级域名）服务器的 IP 地址。
1. 本地 DNS 服务器向 TLD 服务器发送 DNS 查询请求，请求解析该域名对应的 IP 地址。
1. 如果 TLD 服务器中没有该域名对应的 IP 地址，则该请求会被转发到一个负责该域名的权威 DNS 服务器。权威 DNS 服务器会返回该域名对应的 IP 地址。
1. 本地 DNS 服务器将获取到的 IP 地址缓存起来，并将该 IP 地址返回给浏览器。
1. 浏览器利用该 IP 地址与该域名对应的服务器建立连接，然后发送 HTTP 请求。

值得注意的是，DNS 查询的过程中会有多个 DNS 服务器参与。如果某个 DNS 服务器没有缓存该域名对应的 IP 地址，那么它会将该请求转发给另一个 DNS 服务器，并等待该 DNS 服务器的响应。因此，DNS 查询的效率和网络的延迟以及 DNS 服务器的响应速度等因素有关。

#### DNS 同时使用 TCP 和 UDP 协议吗？

是的，DNS 协议可以同时使用 TCP 和 UDP 协议。

在 DNS 查询过程中，大多数查询都使用 UDP 协议进行。这是因为 UDP 协议是无连接的、轻量级的协议，可以快速的发送查询请求并接收响应，且不会占用太多的带宽和系统资源。

然而，当 DNS 响应数据包的大小超过了 512 字节，或者由于某些原因 UDP 协议无法成功传递时，DNS 协议就会自动转换到使用 TCP 协议来进行查询。TCP 协议是面向连接的协议，可以保证数据的可靠性和完整性，但是它会占用更多的系统资源和网络带宽。

#### 讲一下 DNS 的迭代查询与递归查询？

在 DNS 查询中，有两种主要的查询方式：迭代查询（Iterative Query）和递归查询（Recursive Query）。

1. **迭代查询**：在进行 DNS 查询时，客户端会向本地 DNS 服务器发送一个 DNS 查询请求，如果本地 DNS 服务器没有该域名的缓存记录，则会向根域名服务器发送一个查询请求。根域名服务器返回一个所查询域名服务器的地址，本地 DNS 服务器再向该域名服务器发送查询请求。该域名服务器返回所查询域名服务器的地址，本地 DNS 服务器再向该域名服务器发送查询请求，以此类推，直到查询到所需的 IP 地址。
1. **递归查询**：在进行 DNS 查询时，客户端会向本地 DNS 服务器发送一个 DNS 查询请求，如果本地 DNS 服务器没有该域名的缓存记录，则会向根域名服务器发送一个递归查询请求。根域名服务器会查找并返回所查询域名服务器的地址，并向本地 DNS 服务器返回查询结果。如果所查询域名服务器没有该域名的缓存记录，则会向其他域名服务器继续发送递归查询请求，直到查询到所需的 IP 地址。

在迭代查询中，DNS 服务器只返回一个可用的 DNS 服务器的地址，而不会查询其他 DNS 服务器。而在递归查询中，DNS 服务器会一直查询，直到查询到所需的 IP 地址并返回给客户端。因此，递归查询可以帮助客户端快速获取所需的 IP 地址，而迭代查询可以帮助 DNS 服务器分担查询压力。

#### DNS 记录和报文？

DNS（Domain Name System）记录和报文是 DNS 协议中的两个核心概念。DNS 记录是指将域名与 IP 地址进行匹配的记录，它将域名映射为 IP 地址，从而使得设备能够正确地连接到域名对应的 IP 地址。DNS 记录包括多种类型，如 A 记录、CNAME 记录、MX 记录等，不同类型的记录用于不同的目的。在 DNS 协议中，DNS 报文是 DNS 查询和响应的数据包，它包含了 DNS 查询和响应所需的各种信息。DNS 报文由报文头和报文体两部分组成，其中报文头包含了 DNS 报文的一些基本信息，如事务 ID、标志字段、返回码等，而报文体则包含了 DNS 查询和响应的具体内容。下面从不同的角度来介绍 DNS 记录和报文：

1. **DNS 记录**：DNS 记录是 DNS 协议中的一种核心数据结构，它将域名与 IP 地址进行匹配。

常见的 DNS 记录类型包括：

- **A 记录**：将域名映射为 IPv4 地址。
- **AAAA 记录**：将域名映射为 IPv6 地址。
- **CNAME 记录**：将域名映射为另一个域名。
- **MX 记录**：指定邮件服务器的地址。
- **NS 记录**：指定域名服务器的地址。
- **PTR 记录**：将 IP 地址映射为域名。
- **SOA 记录**：指定域名的授权域名服务器和其他元数据。
- **TXT 记录**：包含任意文本信息。

DNS 记录是存储在 DNS 服务器中的，当设备需要连接到某个域名时，它会向本地 DNS 服务器发送 DNS 查询请求，本地 DNS 服务器会根据查询请求中的域名信息，从 DNS 服务器中查找对应的 DNS 记录，然后将域名解析为对应的 IP 地址，返回给设备。

2. **DNS 报文**：DNS 报文是 DNS 协议中的数据包，它包含了 DNS 查询和响应所需的各种信息。DNS 报文由报文头和报文体两部分组成，其中报文头包含了 DNS 报文的一些基本信息，如事务 ID、标志字段、返回码等，而报文体则包含了 DNS 查询和响应的具体内容。

DNS 报文是 DNS 协议中传输数据的基本单位，由 12 字节的固定头部和 4 个长度可变的字段组成。DNS 报文头部包含了 DNS 报文的 ID 标识、标志、数量字段等，而 DNS 报文的可变部分包括查询名、查询类型、查询类、回答资源记录、授权名称服务器、附加资源记录等。下面是 DNS 报文头部的详细说明：

- **事务 ID**：DNS 报文的 ID 标识，对于请求报文和其对应的应答报文，该字段的值是相同的。通过它可以区分 DNS 应答报文是对哪个请求进行响应的。
- **标志**：16bit 的标志字段被划分为若干子字段，包括 QR、Opcode、AA、TC、RD、RA、Z 和 rcode 等。
- **QR**：表示是否是响应报文，0 表示请求报文，1 表示响应报文。
- **Opcode**：操作码，0 表示标准查询，1 表示反向查询，2 表示服务器状态请求。
- **AA**：1 bit 标志，表示授权回答（authoritative answer），默认是 0。
- **TC**：表示是否被截断，用 UDP 时，表示应答长度超过 512 字节时，只返回前 512 字节。
- **RD**：表示期望递归请求，与 RA 对应，一般是请求端发送。该标志为 1，说明服务器必须对该请求进行处理。
- **RA**：表示是否支持递归查询，如果支持，则返回应答报文中的该标志为 1。
- **Z**：保留字段，值为 0。
- **rcode**：返回码字段，表示响应的差错状态，包括 Format error、Server failure、Name Error、Not Implemented 和 Refused 等。
